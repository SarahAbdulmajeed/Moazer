{% extends "main/base.html" %}
{% load static %}

{% block content %}
<div class="container">

    {% if not user.is_authenticated %}
        <h2>مرحبا بالزائر</h2>
        <p>الرجاء تسجيل الدخول لعرض البروفايل.</p>

    {% else %}
        <h2>
            {% if profile_type == "student" %}بروفايل الطالب{% else %}بروفايل الخبير{% endif %}
        </h2>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <label>الاسم الأول</label>
            <input type="text" name="first_name" value="{{ user.first_name }}">

            <label>الاسم الأخير</label>
            <input type="text" name="last_name" value="{{ user.last_name }}">

            <label>البريد الإلكتروني</label>
            <input type="email" name="email" value="{{ user.email }}">

            <label>تاريخ الميلاد</label>
            <input type="date" name="birth_date" value="{{ profile.birth_date }}">

            <label>الجنس</label>
            <select name="gender">
                <option value="male" {% if profile.gender == 'male' %}selected{% endif %}>ذكر</option>
                <option value="female" {% if profile.gender == 'female' %}selected{% endif %}>أنثى</option>
            </select>

            <label>رقم الجوال</label>
            <input type="text" name="phone" value="{{ profile.phone }}">

            <label>المدينة</label>
            <input type="text" name="city" value="{{ profile.city }}">

            <label>نبذة عن {{ profile_type|title }}</label>
            <textarea name="bio">{{ profile.bio }}</textarea>

            <label>الصورة الشخصية</label>
            <input type="file" name="avatar">

            {% if profile_type == "student" %}
                <label>مرحلة الدراسة</label>
                <select name="study_stage">
                    <option value="middle" {% if profile.study_stage=='middle' %}selected{% endif %}>المتوسطة</option>
                    <option value="high" {% if profile.study_stage=='high' %}selected{% endif %}>الثانوية</option>
                    <option value="diploma" {% if profile.study_stage=='diploma' %}selected{% endif %}>الدبلوم</option>
                    <option value="bachelor" {% if profile.study_stage=='bachelor' %}selected{% endif %}>البكالوريوس</option>
                </select>
            {% else %}
                <label>التخصصات</label>
                <select name="specializations" multiple>
                    {% for s in all_specializations %}
                        <option value="{{ s.id }}" {% if s in profile.specializations.all %}selected{% endif %}>{{ s.name }}</option>
                    {% endfor %}
                </select>

                <label>أنواع الاستشارات</label>
                <select name="consultation_types" multiple>
                    {% for c in all_consultation_types %}
                        <option value="{{ c.id }}" {% if c in profile.consultation_types.all %}selected{% endif %}>{{ c.name }}</option>
                    {% endfor %}
                </select>
                <label>قيمة الاستشارة</label>
<input type="number" step="0.01" name="consultation_fee" value="{{ profile.consultation_fee }}">

<label>رقم الآيبان</label>
<input type="text" name="iban_number" value="{{ profile.iban_number }}">

            {% endif %}

            <button type="submit">حفظ التغييرات</button>
            </form>

        <form method="post" action="{% url 'account:delete_profile' %}" style="margin-top:20px;">
            {% csrf_token %}
            <button type="submit" class="delete">حذف الحساب</button>
        </form>

    {% endif %}
</div>
{% endblock %}
