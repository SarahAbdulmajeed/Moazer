{% extends "main/base.html" %}
{% block title %}مختصر — الاستشارات + الخبراء{% endblock %}

{% block content %}

<div class="p-4 space-y-8">

  <!-- Previous Consultations -->
  <div class="flex items-center justify-between mb-3">
    <h3 class="text-lg font-semibold">الاستشارات السابقة</h3>
    <div class="flex flex-row gap-2 items-center">
      <a href="{% url 'consultations:list_view' %}" class="text-sm font-semibold">المزيد</a>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
  </div>
  <section class="rounded-lg glass-card-expert text-center">
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-gray-600 bg-gray-100">
            <th class="py-2 pe-3">رقم</th>
            {% if is_expert %}
            <th class="py-2 pe-3">الطالب</th>
            {% else %}
            <th class="py-2 pe-3">الخبير</th>
            {% endif %}
            <th class="py-2 pe-3">النوع</th>
            <th class="py-2 pe-3">آخر تحديث</th>
            <th class="py-2 pe-3">الحالة</th>
            <th class="py-2">تفاصيل</th>
          </tr>
        </thead>
        <tbody>
          {% for c in consultations_preview %}
            <tr class="border-t border-gray-200">
              <td class="py-2 pe-3">{{ c.id }}</td>
              {% if is_expert %}
                <td class="py-2 pe-3">{{ c.student.username }}</td>
              {% else %}
                <td class="py-2 pe-3">{{ c.expert.username }}</td>
              {% endif %}
              <td class="py-2 pe-3">{{ c.get_type_display }}</td>
              <td class="py-2 pe-3">{{ c.updated_at|date:"Y-m-d" }}</td>
              <td class="py-2 pe-3">
                {% if c.status == "NEW" %}
                  <span class="px-3 py-1 text-xs rounded-full bg-blue-100 text-blue-800"> {{ c.get_status_display }} </span>
                {% elif c.status == "PENDING" %}
                  <span class="px-3 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800"> {{ c.get_status_display }} </span>
                {% elif c.status == "ACTIVE" %}
                  <span class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-800"> {{ c.get_status_display }} </span>
                {% elif c.status == "COMPLETED" %}
                  <span class="px-3 py-1 text-xs rounded-full bg-gray-200 text-gray-800"> {{ c.get_status_display }} </span>
                {% elif c.status == "CLOSED" %}
                  <span class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-800"> {{ c.get_status_display }} </span>
                {% else %}
                  <span class="px-3 py-1 text-xs rounded-full bg-gray-100 text-gray-600"> {{ c.get_status_display }} </span>
                {% endif %}
              </td>
              <td class="py-2">
                <a href="{% url 'consultations:detail_view' consultation_id=c.id %}">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 justify-self-center">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                  </svg>
                </a>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="6" class="py-4 text-gray-500">لا توجد استشارات.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Expert List  -->
  <div class="flex items-center justify-between mb-3">
    <h3 class="text-lg font-semibold">قائمة الخبراء</h3>
    <div class="flex flex-row gap-2 items-center">
      <a href="{% url 'accounts:experts_view' %}" class="text-sm font-semibold">المزيد</a>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>
  </div>

  <section>
    {% if experts_preview %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
      {% for ex in experts_preview %}
      {% include "accounts/components/expert_card.html" with expert=ex %}
      {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-500 text-center">لا يوجد خبراء معتمدين حالياً</p>
    {% endif %}
  </section>

</div>

{% endblock %}
